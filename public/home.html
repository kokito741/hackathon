<!DOCTYPE html>
<html>
<head>

<link rel="icon" href="/favicon.ico" type="image/x-icon">
<title>Home</title>
</head> 
<body>
<h2>Home</h2>
<div id='msg'>Loading...</div>
<button id="logoutBtn">Logout</button>

<script>
(async () => {
  const t = localStorage.getItem('token');
  if (!t) {
    location.href = '/';
    return;
  }

  try {
    console.log('Token being sent to /api/home:', t);
    const r = await fetch('/api/home', {
      headers: { 'Authorization': 'Bearer ' + t }
    });

    if (r.status === 401) {
      localStorage.removeItem('token');
      location.href = '/';
      return;
    }

    const d = await r.json();
    document.getElementById('msg').innerText = d.message || d.error;
  } catch (err) {
    console.error('Fetch error:', err);
    localStorage.removeItem('token');
    location.href = '/';
  }
})();
window.addEventListener('error', e => {
  if(e.message.includes('__cf_bm')) e.preventDefault();
});
// Logout
document.getElementById('logoutBtn').onclick = () => {
  localStorage.removeItem('token');
  location.href = '/';
};
</script>
</body>
</html>
